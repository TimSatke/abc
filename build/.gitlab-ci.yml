image: registry.gitlab.com/timsatke/abc/qa/golang-dind:latest

variables:
  ARTIFACTS_DIR: abc
  GO_PROJECT: gitlab.com/TimSatke/abc

stages:
  - test

before_script:
  - dockerd > /dev/null 2>&1 &
  - cd ${CI_PROJECT_DIR}
  - ls -la /usr/local
  - ls -la /usr/local/go
  - echo $PATH
  - ls -la /usr/local/go/bin
  - go version

test:
  stage: test
  retry: 2
  script:
    - go test -v ./...

benchmarks:
  stage: test
  retry: 2
  allow_failure: true
  script:
    - go test -benchmem -bench .